(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1a4c176d"],{"10bc":function(t,e,a){},"5a4f":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"OrderDetail"},[a("HeaderNav"),t.detailList?a("main",{staticClass:"detail-main"},[a("div",{staticClass:"detail-title"},[1==t.detailList.type?a("span",[t._v("[购买]")]):a("span",[t._v("[出售]")]),t._v("订单号 : "+t._s(t.detailList.no)+" "),a("div",{staticClass:"detail-title-id"},[t._v("["),a("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.detailList.no,expression:"detailList.no",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.onError,expression:"onError",arg:"error"}],attrs:{href:"javascript:void(0)"}},[t._v("复制")]),t._v("] ")])]),a("transition",{attrs:{name:"draw"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.detailShow,expression:"detailShow"}],staticClass:"detail-content"},[a("div",{staticClass:"detail-content-header"},[a("div",{staticClass:"detail-content-buy"},[1==t.detailList.type?a("p",[t._v("购买")]):a("p",[t._v("出售")]),a("p",[t._v(t._s(t.detailList.count)+" USDT")])]),a("div",{staticClass:"detail-content-sell"},[1==t.detailList.type?a("p",[t._v("支出")]):a("p",[t._v("收入")]),a("p",[t._v(t._s(t.detailList.realPrice*t.detailList.count)+" CNY")])]),a("div",{staticClass:"detail-status",class:{Paid:2==t.detailList.status,Complete:3==t.detailList.status,Unpaid:1==t.detailList.status||0==t.detailList.status||-2==t.detailList.status||-3==t.detailList.status}},[t._v(t._s(t.detailList.statusName))])]),a("div",{staticClass:"detail-item"},[a("div",[t._v("交易单价:"+t._s(t.detailList.realPrice)+"CNY/USDT")]),a("div"),a("div",[t._v("交易金额:"+t._s(t.detailList.realPrice*t.detailList.count)+"CNY")]),a("div"),a("div",[t._v("附言码:"+t._s(t.detailList.trmo))]),a("div")]),1==t.detailList.status?a("div",{staticClass:"chatHeader"},[1==t.detailList.type?a("div",{staticClass:"collection"},[1==t.detailList.type?a("div",{staticClass:"collection-name"},[t._v("付款方式")]):a("div",{staticClass:"collection-name"},[t._v("收款方式")]),""==t.accountsList?a("span",{on:{click:t.SetCollection}},[t._v("点我设置收付款账号")]):a("select",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"selected"}],on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selected=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"0"}},[t._v("请选择")]),t._l(t.accountsList,(function(e){return a("option",{domProps:{value:e.id}},[1==e.type?a("span",[t._v("银行卡")]):t._e(),2==e.type?a("span",[t._v("支付宝")]):t._e(),3==e.type?a("span",[t._v("微信")]):t._e(),t._v(" , "+t._s(e.name)+" , "+t._s(e.no)+" ")])}))],2)]):t._e(),1==t.detailList.type?a("div",{staticClass:"collection"},[1==t.detailList.type?a("div",{staticClass:"collection-name"},[t._v("卖家收款方式")]):a("div",{staticClass:"collection-name"},[t._v("卖家付款方式")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedSeller,expression:"selectedSeller"}],on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedSeller=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"0"}},[t._v("请选择")]),t._l(t.sellerAccountList,(function(e){return a("option",{domProps:{value:e.id}},[1==e.type?a("span",[t._v("银行卡")]):t._e(),2==e.type?a("span",[t._v("支付宝")]):t._e(),3==e.type?a("span",[t._v("微信")]):t._e(),t._v(" , "+t._s(e.name)+" , "+t._s(e.no)+" ")])}))],2)]):t._e(),a("div",{staticClass:"cancelDeal",on:{click:function(e){return t.updateOrder(-1)}}},[t._v("取消交易")]),1==t.detailList.type?a("div",{staticClass:"paid",on:{click:function(e){return t.updateOrder(2)}}},[t._v("我已付款")]):t._e(),1==t.detailList.type?a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isTimeout,expression:"!isTimeout"}],staticClass:"prompt"},[a("p",[t._v("1，如您已经向卖方账户转款，请务必点击【我已付款】，及发送交易凭证到交易所对话框，否则将可能造成资金损失!")]),a("p",[t._v("2，订单将在"+t._s(t.detailList.cancelOrderTime)+"自动取消，如一天多次取消，则当日无法再次进行交易。订单自动取消时间为："+t._s(t.detailList.autoCancelOrderTime)+"分钟")])]):a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isTimeout,expression:"!isTimeout"}],staticClass:"prompt"},[a("p",[t._v("1，请联系买方付款，及发送交易凭证到交易所对话框，否则将可能造成资金损失!")]),a("p",[t._v("2，订单将在"+t._s(t.detailList.cancelOrderTime)+"自动取消，如一天多次取消，则当日无法再次进行交易。订单自动取消时间为："+t._s(t.detailList.autoCancelOrderTime)+"分钟")])])]):t._e(),2==t.detailList.status&&2==t.detailList.type?a("div",{staticClass:"chatHeaderSell"},[a("div",{staticClass:"cancelDeal",on:{click:function(e){return t.updateOrder(-2)}}},[t._v("未收到款")]),a("div",{staticClass:"paid",on:{click:function(e){return t.updateOrder(3)}}},[t._v("已收到款")]),a("div",{staticClass:"prompt"},[a("p",[t._v("1，如您已经收到款项，请务必点击【已收到款】，联系买方发送交易凭证到交易所对话框，否则将可能造成资金损失！")]),a("p",[t._v("2，如您未收到款项，请先与买家或者客服联系沟通解决，如无法解决请务必点击【未收到款】，订单状态变为申诉状态，您的账户将暂时无法进行任何交易，系统将介入调解！")])])]):t._e()])]),1==t.detailList.status||2==t.detailList.status?a("div",{staticClass:"accordion",on:{click:function(e){return t.toggle()}}},[t.detailShow?a("div",[t._v("收起详情")]):t._e(),t.detailShow?t._e():a("div",[t._v("展开详情")]),a("div",{class:{"triangle-up":t.detailShow,"triangle-down":!t.detailShow}})]):t._e(),1==t.detailList.status||2==t.detailList.status?a("section",{ref:"chatBox",staticClass:"chatBox"},[a("div",{ref:"chatArea",staticClass:"chat",attrs:{id:"chatArea"}},t._l(t.readList.messages,(function(e){return a("div",{staticClass:"chatMsg",class:{userMsg:e.sendByOneSelf}},[1===e.messageType?a("div",[t._v(t._s(e.messageContent))]):a("img",{attrs:{src:e.messageContent,alt:""}})])})),0),a("div",{ref:"chatFooter",staticClass:"chatFooter"},[a("div",{staticClass:"uploadImg"},[a("input",{staticClass:"imgInput",attrs:{type:"file",name:"saveFile",accept:"image/*"},on:{change:function(e){return t.tirggerFile(e)}}})]),a("div",{staticClass:"chatInputBox"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.chatContent,expression:"chatContent",modifiers:{trim:!0}}],staticClass:"chatInput",attrs:{type:"text"},domProps:{value:t.chatContent},on:{input:function(e){e.target.composing||(t.chatContent=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),a("div",{staticClass:"chatSubmit",on:{click:t.chatSubmit}})])])]):t._e()],1):t._e()],1)},s=[],n=(a("c975"),a("ace4"),a("b0c0"),a("d3b7"),a("ac1f"),a("1276"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a9"),a("72f7"),a("c330")),o=a("76a0"),l={components:{HeaderNav:n["a"]},data:function(){return{orderDetailsData:{orderId:""},detailData:"",detailList:{id:1,status:1,no:456879123,count:400,realPrice:2,statusName:"OK",trmo:3215647889,cancelOrderTime:5,autoCancelOrderTime:10},detailShow:!0,chatContent:"",sendData:{orderId:"",content:"",messageType:""},readList:{messages:[{messageContent:"456789",messageType:1},{messageContent:"1111111",messageType:1,sendByOneSelf:!0}]},timerFn:null,updateOrderData:{orderId:"",status:""},accountsList:{type:1,name:"XXXXXXXX",no:6547893210},alertTitle:"",selected:"0",sellerAccountList:"",selectedSeller:"0",isTimeout:!1}},created:function(){this.detailData=this.$storage.session.get("detailData"),this.sendData.orderId=this.detailData.id,this.orderDetailsData.orderId=this.detailData.id},mounted:function(){this.getRead();var t=this;document.onkeydown=function(e){var a=document.all?window.event:e;13===a.keyCode&&t.chatSubmit()}},updated:function(){if(1===this.detailData.status||2===this.detailData.status){document.querySelector(".chatBox").style.height="calc(100% - "+document.querySelector(".chatBox").offsetTop+"px)";var t=this.$refs.chatArea.getBoundingClientRect().top-this.$refs.chatBox.getBoundingClientRect().top+this.$refs.chatFooter.getBoundingClientRect().height;document.querySelector(".chat").style.height="calc(100% - "+t+"px)",this.detailShow||setTimeout((function(){document.querySelector(".chatBox").style.height="calc(100% - "+document.querySelector(".chatBox").offsetTop+"px)";var t=document.querySelector(".chat").offsetTop-document.querySelector(".chatBox").offsetTop+document.querySelector(".chatFooter").height;document.querySelector(".chat").style.height="calc(100% - "+t+"px)"}),100),this.scrollBottom()}},methods:{messagePage:function(){this.$router.push({name:"MessagePage"})},onCopy:function(t){Object(o["MessageBox"])({title:"温馨提示",message:"订单号复制成功",closeOnClickModal:!1})},onError:function(t){Object(o["MessageBox"])({title:"警告",message:"订单号复制失败",closeOnClickModal:!1})},toggle:function(){this.detailShow=!this.detailShow},chatSubmit:function(){var t=this;""!==this.chatContent?(this.sendData.content=this.chatContent,this.chatContent="",this.sendData.messageType=1,apiSend(this.sendData,!0).then((function(e){e.success&&t.getRead()}))):Object(o["Toast"])({message:"请输入要发送的信息!",iconClass:"mint-toast-icon mintui mintui-field-error icon-black",duration:1500})},scrollBottom:function(){this.$nextTick((function(){var t=document.getElementById("chatArea");t.scrollTop=t.scrollHeight}))},getRead:function(){},timer:function(){var t=this;"OrderDetail"===this.$router.currentRoute.name&&(this.timerFn=setTimeout((function(){t.getRead()}),1e4))},updateOrder:function(t){this.updateOrderData.orderId=this.detailData.id,this.updateOrderData.status=t,-2===t&&(this.alertTitle="如果您未收到款，此订单将会变为申诉中，您将暂时无法进行其他交易，系统将会介入调解！",this.alertMessageBox(this.alertTitle)),-1===t&&(this.alertTitle="如果您当日取消交易次数过多，您今日将无法进行交易！",this.alertMessageBox(this.alertTitle)),2===t&&(this.alertTitle="请确认您是否已付款，若您未付款请点击取消进行付款，如已付款请点击确认继续，祝你愉快！","0"===this.selected?Object(o["Toast"])({message:"请选择付款方式!",iconClass:"mint-toast-icon mintui mintui-field-error icon-black",duration:2e3}):"0"===this.selectedSeller&&Object(o["Toast"])({message:"请选择卖家收款方式!",iconClass:"mint-toast-icon mintui mintui-field-error icon-black",duration:2e3}),"0"!==this.selectedSeller&&"0"!==this.selected&&(this.updateOrderData.payAccountId=this.selected,this.updateOrderData.accountId=this.selectedSeller,this.alertMessageBox(this.alertTitle))),3===t&&(this.alertTitle="请确认您已收到款项，将完成此笔交易！祝您愉快！",this.alertMessageBox(this.alertTitle))},alertMessageBox:function(t){var e=this;console.log(t),o["MessageBox"].confirm("请确认是否继续？",t).then((function(t){e.determine()})).catch((function(t){return t}))},determine:function(){apiUpdateOrder(this.updateOrderData,!0).then((function(t){window.location.reload(),t.success?Object(o["Toast"])({message:t.msg,iconClass:"icon-success",duration:2e3}):Object(o["Toast"])({message:t.msg,iconClass:"mint-toast-icon mintui mintui-field-error icon-black",duration:2e3})}))},SetCollection:function(){this.$storage.session.set("backurl","OrderDetail"),this.$router.push({name:"SetCollectionPage"})},tirggerFile:function(t){var e=t.target.files[0],a=e.size,i=new FormData;i.append("file",e,e.name),i.append("type","1"),t.target.files.length&&(a/1024>1e4||(this.imgPreview(e),this.getRead()))},imgPreview:function(t,e){var a=this,i={headers:{"Content-Type":"multipart/form-data"}};if(t&&window.FileReader){var s=new FileReader;s.readAsDataURL(t),s.onloadend=function(){var e=this.result,s=new Image;s.src=e,s.onload=function(){var n=a.compress(s);a.imgUrl=e;var l=a.dataURItoBlob(n),c=new FormData;c.append("file",l,t.name),apiUploadImg(c,i).then((function(t){t.Success?(a.sendData.messageType=2,a.sendData.content=t.Data.Url,apiSend(a.sendData,!0).then((function(t){t.success&&apiRead(a.orderDetailsData,!0).then((function(t){a.readList.length===t.result.length||(a.readList=t.result)}))}))):Object(o["Toast"])({message:t.Msg,iconClass:"mint-toast-icon mintui mintui-field-error icon-black",duration:3e3})}))}}}},compress:function(t){var e=document.createElement("canvas"),a=e.getContext("2d"),i=t.width,s=t.height;e.width=i,e.height=s,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.drawImage(t,0,0,i,s);var n=e.toDataURL("image/jpeg",.1);return n},dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var a=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length),s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return new Blob([i],{type:a})},delImg:function(){this.imgUrl=null}},destroyed:function(){clearTimeout(this.timerFn)}},c=l,r=(a("5be6"),a("2877")),d=Object(r["a"])(c,i,s,!1,null,"513d11dc",null);e["default"]=d.exports},"5be6":function(t,e,a){"use strict";var i=a("10bc"),s=a.n(i);s.a}}]);